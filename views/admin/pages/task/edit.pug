extends ../../layouts/default.pug

block main 
    
    +alert-success(3000)
    +alert-error(3000)

    h1 Chỉnh sửa công việc

    .card
        .card-body
            form(
                action=`${prefixAdmin}/tasks/edit/${task._id}?_method=PATCH` 
                method="POST"
                )
                input(
                    type="hidden" 
                    name="returnUrl" 
                    value=(returnUrl ? returnUrl : "/admin/tasks")
                )
                div(class="form-group mb-3")
                    label(for="title") Tiêu đề
                    input(
                        type="text" 
                        class="form-control" 
                        id="title" 
                        name="title" 
                        value=task.title 
                        required
                    )

                div(class="form-group mb-3")
                    label(for="description") Mô tả
                    textarea(
                        class="form-control" 
                        id="description" 
                        name="description" 
                        rows="5"
                    ) #{task.description}

                div(class="form-group mb-3")
                    label(for="status") Trạng thái
                    select(
                        class="form-control" 
                        id="status" 
                        name="status"
                    )
                        option(value="todo" selected=(task.status == 'todo')) Todo
                        option(value="in-progress" selected=(task.status == 'in-progress')) Đang làm
                        option(value="done" selected=(task.status == 'done')) Hoàn thành

                div(class="form-group mb-3")
                    label(for="priority") Ưu tiên
                    select(
                        class="form-control" 
                        id="priority" 
                        name="priority"
                    )
                        option(value="low" selected=(task.priority == 'low')) Thấp
                        option(value="medium" selected=(task.priority == 'medium')) Trung bình
                        option(value="high" selected=(task.priority == 'high')) Cao

                div(class="form-group mb-3")
                    label(for="due_date") Hạn chót
                    input(
                        type="date" 
                        class="form-control" 
                        id="due_date" 
                        name="due_date" 
                        value=(task.due_date ? new Date(task.due_date).toISOString().split('T')[0] : "")
                    ) 
                
                div(class="form-group mb-3")
                    label(for="project_id") Project
                    select(
                        class="form-control" 
                        id="project_id" 
                        name="project_id"
                    )
                        option(value="") -- Chọn project --
                        each item, index in projects
                            option(
                                value=item._id 
                                selected=(task.project_id && item._id.toString() == task.project_id._id.toString())
                            ) #{item.title}

                div(class="form-group mb-3")
                    label(for="assigned_to") Thành viên phụ trách
                    select(
                        class="form-control" 
                        id="assigned_to" 
                        name="assigned_to"
                    )
                        option(value="") -- Chọn thành viên --
                        each item in members
                            option(value=item._id selected=(task.assigned_to && item._id.toString() == task.assigned_to._id.toString())) #{item.fullName}

                div(class="mb-3")
                    label(class="form-label") Người Hỗ trợ
                    select(
                        id="participants"
                        name="participants"
                        class="form-control select2"
                        multiple="multiple"  
                    )
                        if(members)
                            each item in members
                                option(
                                    value=item.id
                                    selected=(task.participants && task.participants.some(p => (p._id || p).toString() === item.id))
                                ) #{item.fullName}

                button(
                    type="submit" 
                    class="btn btn-primary"
                ) Cập nhật

